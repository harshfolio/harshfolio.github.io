
<a class="skip-to-main" href="#main-content">Skip to main content</a>

{{- if and .IsPage (eq .Section "posts") }}
<div class="reading-progress">
    <div class="reading-progress-bar"></div>
</div>
{{- end }}

<header class="header">
    <nav class="nav">
        <a href="{{ "" | absLangURL }}" accesskey="h" title="{{ site.Title }}" class="logo">
            <img src="{{ "images/asterisk.svg" | absURL }}" alt="*" class="logo-icon">
            <span class="logo-text">Harsh</span>
        </a>

        <div class="nav-right">
          {{/* Inline desktop menu (hidden on mobile) */}}
          <ul class="menu-inline" role="menubar">
            {{- if gt (len site.Menus.main) 0 -}}
              {{- $currentPage := . -}}
              {{- range site.Menus.main }}
                {{- $menu_item_url := (cond (strings.HasSuffix .URL "/") .URL (printf "%s/" .URL)) | absLangURL -}}
                {{- $page_url := $currentPage.Permalink | absLangURL -}}
                <li role="none">
                  <a role="menuitem" href="{{ .URL | absLangURL }}" class="menu-inline__link{{ if eq $menu_item_url $page_url }} is-active{{ end }}">{{ .Name }}</a>
                </li>
              {{- end -}}
            {{- else -}}
              <li role="none"><a role="menuitem" href="{{ "" | absLangURL }}" class="menu-inline__link">Home</a></li>
              <li role="none"><a role="menuitem" href="{{ "posts" | absLangURL }}" class="menu-inline__link">Blog</a></li>
            {{- end -}}
          </ul>
          <button class="header-theme-toggle" aria-label="Toggle theme" title="Toggle theme" onclick="toggleTheme()">
            <!-- Moon (dark indicator) -->
            <svg class="icon-moon" xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
              <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
            </svg>
            <!-- Sun (light indicator) -->
            <svg class="icon-sun" xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
              <circle cx="12" cy="12" r="5"></circle>
              <line x1="12" y1="1" x2="12" y2="3"></line>
              <line x1="12" y1="21" x2="12" y2="23"></line>
              <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
              <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
              <line x1="1" y1="12" x2="3" y2="12"></line>
              <line x1="21" y1="12" x2="23" y2="12"></line>
              <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
              <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
            </svg>
          </button>
          <button id="menu-toggle" aria-label="Open menu" aria-expanded="false" aria-controls="side-menu" class="menu-toggle">
            <svg class="menu-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round">
                <line x1="3" y1="6" x2="21" y2="6"></line>
                <line x1="3" y1="12" x2="21" y2="12"></line>
                <line x1="3" y1="18" x2="21" y2="18"></line>
            </svg>
          </button>
        </div>
    </nav>
  </header>

  <div id="side-menu" class="side-menu" aria-hidden="true">
    <div class="side-menu__backdrop" data-close="true"></div>
    <aside class="side-menu__panel" role="dialog" aria-modal="true" aria-labelledby="side-menu-title">
      <div class="side-menu__header">
        <span id="side-menu-title" class="side-menu__title">
          {{- if eq site.Title "Harsh Sharma" -}}
            Harsh<span class="logo-break"><br></span> Sharma
          {{- else -}}
            {{ site.Title }}
          {{- end -}}
        </span>
        <div class="side-menu__actions">
          <button id="menu-close" class="side-menu__close" aria-label="Close menu">
            <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
          </button>
        </div>
      </div>
      <nav class="side-menu__nav" role="navigation">
        {{- if gt (len site.Menus.main) 0 -}}
          {{- range site.Menus.main }}
            {{- $active := or ($.IsMenuCurrent "main" .) ($.HasMenuCurrent "main" .) -}}
            <a href="{{ .URL | absLangURL }}" class="side-menu__link"{{ if $active }} aria-current="page"{{ end }}>{{ .Name }}</a>
          {{- end -}}
        {{- else -}}
          <a href="{{ "" | absLangURL }}" class="side-menu__link">Home</a>
          <a href="{{ "posts" | absLangURL }}" class="side-menu__link">Blog</a>
        {{- end -}}
      </nav>

      {{- with site.Params.socialIcons }}
      <div class="side-menu__social" aria-label="Social links">
        {{- range . }}
          {{- $label := .name | title }}
          {{- $name := (lower .name) -}}
          <a href="{{ .url | safeURL }}" class="social-btn social-btn--{{ $name }}" target="_blank" rel="noopener noreferrer" aria-label="{{ $label }}">
            {{- if eq $name "github" -}}
              <svg aria-hidden="true" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 .5a12 12 0 0 0-3.79 23.4c.6.1.82-.26.82-.58v-2.03c-3.34.73-4.04-1.61-4.04-1.61-.55-1.4-1.34-1.77-1.34-1.77-1.1-.75.08-.73.08-.73 1.22.09 1.86 1.25 1.86 1.25 1.08 1.86 2.84 1.32 3.53 1 .11-.78.42-1.32.76-1.62-2.67-.3-5.47-1.34-5.47-5.95 0-1.31.47-2.38 1.24-3.22-.12-.3-.54-1.52.12-3.17 0 0 1.01-.32 3.3 1.23a11.5 11.5 0 0 1 6 0c2.29-1.55 3.3-1.23 3.3-1.23.66 1.65.24 2.87.12 3.17.77.84 1.24 1.91 1.24 3.22 0 4.62-2.8 5.65-5.48 5.95.43.37.81 1.1.81 2.22v3.29c0 .32.21.69.82.58A12 12 0 0 0 12 .5Z"/>
              </svg>
            {{- else if or (eq $name "linkedin") (eq $name "linkeDin") -}}
              <svg aria-hidden="true" viewBox="0 0 24 24" fill="currentColor">
                <path d="M4.98 3.5C4.98 4.88 3.86 6 2.5 6S0 4.88 0 3.5 1.12 1 2.5 1s2.48 1.12 2.48 2.5zM0 8h5v16H0zM8.5 8H13v2.2h.06c.62-1.17 2.14-2.4 4.41-2.4 4.72 0 5.59 3.11 5.59 7.16V24h-5v-6.9c0-1.64-.03-3.74-2.28-3.74-2.28 0-2.63 1.78-2.63 3.62V24h-5z"/>
              </svg>
            {{- else if or (eq $name "x") (eq $name "twitter") -}}
              <svg aria-hidden="true" viewBox="0 0 24 24" fill="currentColor">
                <path d="M18 2h3l-7.5 9.5L22 22h-6l-4.5-6L6 22H3l8-10L4 2h6l4 5 5-5z"/>
              </svg>
            {{- end -}}
            <span class="sr-only">{{ $label }}</span>
          </a>
        {{- end }}
      </div>
      {{- end }}
    </aside>
  </div>

  <script>
        (function() {
          const menuToggle = document.getElementById('menu-toggle');
          const sideMenu = document.getElementById('side-menu');
          const closeBtn = document.getElementById('menu-close');
          const header = document.querySelector('.header');
          if (!menuToggle || !sideMenu) return;

          let lastFocused = null;

          const getFocusable = () => sideMenu.querySelectorAll('a, button, [tabindex]:not([tabindex="-1"])');

          function openMenu() {
            lastFocused = document.activeElement;
            sideMenu.classList.add('open');
            sideMenu.setAttribute('aria-hidden', 'false');
            menuToggle.setAttribute('aria-expanded', 'true');
            menuToggle.classList.add('open');
            document.body.classList.add('no-scroll');
            if (header) header.classList.remove('header--hidden');
            const items = getFocusable();
            if (items.length) items[0].focus();
          }

          function closeMenu() {
            sideMenu.classList.remove('open');
            sideMenu.setAttribute('aria-hidden', 'true');
            menuToggle.setAttribute('aria-expanded', 'false');
            menuToggle.classList.remove('open');
            document.body.classList.remove('no-scroll');
            if (lastFocused) lastFocused.focus();
          }

          // Toggle click
          menuToggle.addEventListener('click', () => {
            const isExpanded = menuToggle.getAttribute('aria-expanded') === 'true';
            if (isExpanded) closeMenu(); else openMenu();
          });

          // Close button
          if (closeBtn) closeBtn.addEventListener('click', closeMenu);

          // Backdrop click
          sideMenu.addEventListener('click', (e) => {
            if (e.target && e.target.getAttribute('data-close') === 'true') {
              closeMenu();
            }
          });

          // Keyboard handling
          document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') closeMenu();
          });

          // Basic focus trap
          sideMenu.addEventListener('keydown', (e) => {
            if (e.key !== 'Tab') return;
            const items = Array.from(getFocusable());
            if (!items.length) return;
            const first = items[0];
            const last = items[items.length - 1];
            if (e.shiftKey && document.activeElement === first) {
              e.preventDefault();
              last.focus();
            } else if (!e.shiftKey && document.activeElement === last) {
              e.preventDefault();
              first.focus();
            }
          });
        })();
  </script>

  <script>
        // Header hide/show on scroll: hide while scrolling down, show on scroll up or when scrolling stops
        (function() {
          const header = document.querySelector('.header');
          if (!header) return;

          let lastY = window.scrollY;
          let scrollEndTimer = null;

          function onScroll() {
            const y = window.scrollY;
            const delta = y - lastY;
            lastY = y;

            const sideMenu = document.getElementById('side-menu');
            const menuOpen = sideMenu && sideMenu.classList.contains('open');

            if (!menuOpen) {
              if (delta > 6 && y > 24) {
                header.classList.add('header--hidden');
              } else if (delta < -6 || y < 24) {
                header.classList.remove('header--hidden');
              }
            }

            // Reveal header shortly after scrolling stops
            clearTimeout(scrollEndTimer);
            scrollEndTimer = setTimeout(() => {
              header.classList.remove('header--hidden');
            }, 150);
          }

          window.addEventListener('scroll', onScroll, { passive: true });
        })();
  </script>
