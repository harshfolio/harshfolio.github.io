<footer class="footer">
    {{- if (not site.Params.disableThemeToggle) }}
    <div class="footer-theme-toggle">
        <button id="theme-toggle" accesskey="t" title="Toggle theme" aria-label="Toggle dark mode" onclick="toggleTheme()">
            <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24"
                fill="currentColor">
                <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
            </svg>
            <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24"
                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                stroke-linejoin="round">
                <circle cx="12" cy="12" r="4"></circle>
                <path d="M12 2v2m0 16v2M4.93 4.93l1.41 1.41m11.32 11.32l1.41 1.41M2 12h2m16 0h2M6.34 17.66l-1.41 1.41M19.07 4.93l-1.41 1.41"></path>
            </svg>
        </button>
    </div>
    <script>
        // Ensure the theme toggle is visible once rendered
        (function () {
            var btn = document.getElementById('theme-toggle');
            if (btn) btn.classList.add('loaded');
        })();
    </script>
    <script>
        function toggleTheme() {
            const currentTheme = localStorage.getItem("pref-theme") || "auto";
            let newTheme;

            if (currentTheme === "light") {
                newTheme = "dark";
            } else if (currentTheme === "dark") {
                newTheme = "auto";
            } else {
                newTheme = "light";
            }

            localStorage.setItem("pref-theme", newTheme);
            applyTheme(newTheme);
        }

        function applyTheme(theme) {
            if (theme === "light") {
                document.body.classList.remove("dark");
            } else if (theme === "dark") {
                document.body.classList.add("dark");
            } else {
                if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
                    document.body.classList.add("dark");
                } else {
                    document.body.classList.remove("dark");
                }
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
            applyTheme(localStorage.getItem("pref-theme") || "auto");
        });
    </script>
    {{- end }}

    <div class="year-progress" role="status" aria-label="Year progress indicator">
        <div class="year-progress-label">
            <span id="year-percentage">0</span>% of {{ now.Year }}
        </div>
        <div class="year-progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">
            <div class="year-progress-fill" id="year-progress-fill"></div>
        </div>
    </div>
    <span>Â© {{ now.Year }} Harsh Sharma</span>
</footer>

<script>
    (function() {
        const now = new Date();
        const start = new Date(now.getFullYear(), 0, 1);
        const end = new Date(now.getFullYear() + 1, 0, 1);
        const progress = ((now - start) / (end - start)) * 100;

        const fillElement = document.getElementById('year-progress-fill');
        const percentageElement = document.getElementById('year-percentage');

        if (fillElement && percentageElement) {
            const progressValue = progress.toFixed(2);
            fillElement.style.width = progressValue + '%';
            percentageElement.textContent = progress.toFixed(1);

            const progressBar = document.querySelector('.year-progress-bar');
            if (progressBar) {
                progressBar.setAttribute('aria-valuenow', progressValue);
            }
        }
    })();
</script>
